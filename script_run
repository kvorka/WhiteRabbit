#!/bin/bash
compiler=gfortran-10
optimization=Ofast

#vyber z moznosti
code_ice="ice"
code_convection="convection"
code_tides="tides"
code_oceanIce="iceOcean"
code_test="speed"

#co sa ice pocitat
code_type="iceOcean"

#priprava priecinkov
rm -r -f data || true
mkdir data

#kompilacia zakladov programu
./code/scripts/compileBaseLine $compiler $optimization

if [ "$code_type" = "$code_oceanIce" ]; then
mkdir data/data_ice_topo
mkdir data/data_ice_shape
mkdir data/data_ice_tides

mkdir data/data_ocean_temp
mkdir data/data_ocean_veloc
mkdir data/data_ocean_flux

#kompilacia modelu oceana a ladovej kory
$compiler -$optimization -march=native -fopenmp -c code/ocean/mods/OceanIceMod.f90  #casova schema ocean

$compiler -$optimization -march=native -c code/ice/tides/IceTidesMod.f90           #casova schema slapy
$compiler -$optimization -march=native -fopenmp -c code/ice/crust/IceCrustMod.f90  #casova schema ladova kora

$compiler -$optimization -march=native -fopenmp code/codes/BielyKralik_oceanIce.f90 *.o -o Test_oceanIce -lfftw3  #vypocet
fi

if [ "$code_type" = "$code_tides" ]; then
#kompilacia modelu oceanskych slapov
$compiler -$optimization -march=native -fopenmp -c code/ocean/mods/OceanTidesMod.f90                       #casova schema
$compiler -$optimization -march=native -fopenmp code/codes/BielyKralik_tidesOcean.f90 *.o -o Test_tides -lfftw3  #vypocet
fi

#kompilacia rychlostneho testu
if [ "$code_type" = "$code_test" ]; then
mkdir data/data_ocean_temp
mkdir data/data_ocean_veloc
mkdir data/data_ocean_flux

$compiler -$optimization -march=native -fopenmp -c code/ocean/mods/OceanConvMod.f90                             #casova schema
$compiler -$optimization -march=native -fopenmp code/codes/BielyKralik_speedTest.f90 *.o -o Test_speed -lfftw3  #vypocet
fi

#kompilacia modelu oceanskej konvekcie
if [ "$code_type" = "$code_convection" ]; then
mkdir data/data_ocean_temp
mkdir data/data_ocean_veloc
mkdir data/data_ocean_flux

$compiler -$optimization -march=native -fopenmp -c code/ocean/mods/OceanConvMod.f90                             #casova schema
$compiler -$optimization -march=native -fopenmp code/codes/BielyKralik_oceanConv.f90 *.o -o Test_convection -lfftw3  #vypocet
fi

if [ "$code_type" = "$code_ice" ]; then
mkdir data/data_ice_topo
mkdir data/data_ice_shape
mkdir data/data_ice_tides

#kompilacia modelu ladovej kory
$compiler -$optimization -march=native -c code/ice/tides/IceTidesMod.f90           #casova schema slapy
$compiler -$optimization -march=native -fopenmp -c code/ice/crust/IceCrustMod.f90  #casova schema ladova kora

$compiler -$optimization -march=native -fopenmp code/codes/BielyKralik_Ice.f90 *.o -o Test_ice -lfftw3  #vypocet
fi

#cistenie
rm *.smod *.mod *.o
