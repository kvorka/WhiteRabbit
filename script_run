#!/bin/bash
compiler=gfortran-12
optimization=Ofast
arch=march=native

#vyber z moznosti
code_ice="ice"
code_convection="convection"
code_tides="tides"
code_oceanIce="iceOcean"
code_test="speed"

#co sa ice pocitat
code_type="speed"

#priprava priecinkov
rm -r -f data || true
mkdir data

#kompilacia zakladov programu
./kernels/compileBaseLine $compiler $optimization $arch

if [ "$code_type" = "$code_oceanIce" ]; then
mkdir data/data_ice_topo
mkdir data/data_ice_shape
mkdir data/data_ice_tides

mkdir data/data_ocean_temp
mkdir data/data_ocean_veloc
mkdir data/data_ocean_flux

#kompilacia modelu oceana a ladovej kory
$compiler -$optimization -march=native          -c code/ice/mod/IceTidesMod.f90
$compiler -$optimization -march=native -fopenmp -c code/ice/mod/IceCrustMod.f90
$compiler -$optimization -march=native -fopenmp -c code/ocean/mod/OceanIceMod.f90

$compiler -$optimization -march=native -fopenmp code/codes/BielyKralik_oceanIce.f90 *.o -o Test_oceanIce
fi

if [ "$code_type" = "$code_tides" ]; then
#kompilacia modelu oceanskych slapov
$compiler -$optimization -march=native -fopenmp -c code/ocean/mod/OceanTidesMod.f90

$compiler -$optimization -march=native -fopenmp code/codes/BielyKralik_tidesOcean.f90 *.o -o Test_tides
fi

#kompilacia rychlostneho testu
if [ "$code_type" = "$code_test" ]; then
mkdir data/data_ocean_temp
mkdir data/data_ocean_veloc
mkdir data/data_ocean_flux

$compiler -$optimization -march=native -fopenmp -c code/ocean/mod/OceanConvMod.f90

$compiler -$optimization -march=native -fopenmp code/codes/BielyKralik_speedTest.f90 *.o -o Test_speed
fi

#kompilacia modelu oceanskej konvekcie
if [ "$code_type" = "$code_convection" ]; then
mkdir data/data_ocean_temp
mkdir data/data_ocean_veloc
mkdir data/data_ocean_flux

$compiler -$optimization -march=native -fopenmp -c code/ocean/mod/OceanConvMod.f90

$compiler -$optimization -march=native -fopenmp code/codes/BielyKralik_oceanConv.f90 *.o -o Test_convection
fi

if [ "$code_type" = "$code_ice" ]; then
mkdir data/data_ice_topo
mkdir data/data_ice_shape
mkdir data/data_ice_tides

#kompilacia modelu ladovej kory
$compiler -$optimization -march=native          -c code/ice/mod/IceTidesMod.f90
$compiler -$optimization -march=native -fopenmp -c code/ice/mod/IceCrustMod.f90

$compiler -$optimization -march=native -fopenmp code/codes/BielyKralik_Ice.f90 *.o -o Test_ice
fi

#cistenie
rm *.smod *.mod *.o
